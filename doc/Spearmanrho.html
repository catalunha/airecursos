<HTML>                                                           
<HEAD>
<title>Spearman's Rho Distribution Function</title>

<SCRIPT LANGUAGE="JavaScript">

var v;
var x = new Array(11);
var p = new Array(11);
var del = new Array(11);
var count = new Array(165);
var fac = new Array(11);
fac[0]=1;
for (var i=1;i<=10;i++) {
	fac[i]=i*fac[i-1]
}

function init(n) {
	for (var i=1;i<=n;i++) {
		x[i]=i;
		p[i]=i;
		del[i]=1;
	}
	for (i=0;i<v;i++) {
		count[i]=0
	}
	count[v]=1;
}

function swap(k) {
	var temp=x[k];
	x[k]=x[k+1];
	x[k+1]=temp;
	p[x[k]]=k;
	p[x[k+1]]=k+1;
	v=v+x[k+1]-x[k];
	count[v]++;
}

function flex(k) {
	var j;
	if (k==n) {
		for(j=1;j<k;j++) {
			swap(p[k]-del[k])
		}
		del[k]=1-del[k];
	} else {
		for(j=1;j<k;j++) {
			flex(k+1);
			swap(p[k]-del[k])
		}
		del[k]=1-del[k];
		flex(k+1)
	}
}

function normalcdf(X){   //HASTINGS.  MAX ERROR = .000001
	var T=1/(1+.2316419*Math.abs(X));
	var D=.3989423*Math.exp(-X*X/2);
	var Prob=D*T*(.3193815+T*(-.3565638+T*(1.781478+T*(-1.821256+T*1.330274))));
	if (X>0) {
		Prob=1-Prob
	}
	return Prob
}

function compute(form) {
	var Prob,sum,i,cc;
    n=Math.floor(eval(form.samplesize.value));
    s=Math.floor(eval(form.cutoff.value));
	s=Math.floor(s/2);
	if (n<2) {
		alert("n must at least 2")
	} else {
		v=n*(n-1)*(n+1)/6;
		if (s<0) {
			Prob=0
		} else if (s>=v) {
			Prob=1
		}
		else if (n>8) {
			mean = n*(n+1)*(n-1)/12;
			stdev = n*(n+1)*Math.sqrt(n-1)/12;
			z1=(s+.5-mean)/stdev;
			cc=.5+z1*(z1*z1-3)/2;
			z=(s+cc-mean)/stdev;
			Prob=normalcdf(z);
		} else {
			init(n);
			flex(2);
			sum=0;
			for (i=0;i<=s;i++) {
				sum=sum+count[i]/fac[n]
			}
			Prob=sum;
		}
		form.result.value =Math.round(Prob*10000)/10000+" "
	}
	
}
</SCRIPT>
</HEAD>

<BODY>
<center>
<hr size=5>
<h1>Distribution of Spearman's Rho</h1>
<i>JavaScript</i>
<hr size=5>

Spearman's rho is related to the statistic 
S<sub>n</sub>=(R<sub>1</sub>-1)<sup>2</sup>+...+(R<sub>n</sub>-n)<sup>2</sup>
<br>
where (R<sub>1</sub>,R<sub>2</sub>,...,R<sub>n</sub>) is a permutation 
of the integers from 1 to n.<br>
Here you can find the distribution of S<sub>n</sub> when the permutation is<br> 
chosen at random uniformly over all n! permutations. 
<hr>
<FORM>
<pre>
      Enter Spearman rho Arguments:

      sample size n: <INPUT TYPE="text" NAME="samplesize" Value="10" SIZE=15>
            s-value: <INPUT TYPE="text" NAME="cutoff" Value="164" SIZE=15>
</pre>

<BR>

 P(S<sub>n</sub> <= s):
<INPUT TYPE="text" NAME="result" SIZE=21>
<INPUT TYPE="button" VALUE="Calculate" ONCLICK="compute(this.form)">
<BR>
</FORM>
<hr>
The statistic S<sub>n</sub> takes values in the even integers between 0 and<br>
(n-1)n(n+1)/3 inclusive. The distribution is symmetric about the mean,<br>
(n-1)n(n+1)/6, and the variance is n<sup>2</sup>(n+1)<sup>2</sup>(n-1)/36.
<p>
The distribution function of S<sub>n</sub> is computed exactly for n<=8.<br>
For n>8, a normal approximation with continuity correction is used.<br>
For n>8, the maximum absolute error of the approximation is .003.
</center>
</BODY>
</HTML>

